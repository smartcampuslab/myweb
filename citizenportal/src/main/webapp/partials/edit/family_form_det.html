<form role="form" name="form" >

	<tabset>
		<tab  ng-repeat="ft in family_tabs" heading="{{ ft.title }}" active="ft.active" disabled="ft.disabled" select="setIndexFamily($index)">
			<br>
			<div class="panel panel-default" >
				<div class="panel-heading">
			   		<h3 class="panel-title"><strong>Dati Anagrafici Componente</strong></h3>
				</div>
				<div class="panel-body">
					<table width="100%">
			   			<tr>
							<td width="50%">Data di nascita: <strong>{{ (ft.content.persona.dataNascita | date:"dd/MM/yyyy") }}</strong></td></span>
							<td width="50%">Richiedente: <strong>{{ ft.content.richiedente | boolToString }}</strong></td>
						</tr>
						<tr>
							<td>Parentela: <strong>{{ ft.content.parentela | codeToName: affinities }}</strong></td>
							<td>Stato Civile: <strong>{{ ft.content.statoCivile | codeToName: maritals }}</strong></td>
						</tr>
			   		</table>
			   	</div>
			</div>
			   		
			<div class="panel panel-default" >
				<div class="panel-heading">
			   		<h3 class="panel-title"><strong>Dati Personali Componente</strong></h3>
				</div>
				<div class="panel-body">
					<div class="panel panel-default" ng-show="isSRFormVisible == true">
			  			<div class="panel-heading">
			   				<h3 class="panel-title"><strong>Anni di Residenza</strong></h3>
						</div>
			  			<div class="panel-body">
			  				<table  width="100%">
								<tr>
									<th>Comune</th>
									<th>Dal </th>
									<th>Al</th>
									<th></th>
									<th></th>
								</tr>
								<tr>
									<td>
										<select id="fam_municipality" name="pFamMunicipality" class="form-control" ng-options="l.idObj as l.descrizione for l in listaComuni" ng-model="sr.idComuneResidenza">
					   					<option value="">Seleziona comune di residenza</option>
					   					</select>
						    		</td>
									<td>
			  							<input type="date" class="form-control" id="fromDate" name="pFromDate" placeholder="Inserisci data di inizio nel formato aaaa-MM-gg" ng-model="sr.dataDa">
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFromDate.$error.pattern">Valore non corretto. Inserire la data nel formato aaaa-MM-gg</div>
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFromDate.$error.required">Inserire un valore nel campo 'Data da'</div>
						    		</td>
						    		<td>
										<input type="date" class="form-control" id="toDate" name="pToDate" placeholder="Inserisci data di fine nel formato aaaa-MM-gg" ng-model="sr.dataA">
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pToDate.$error.pattern">Valore non corretto. Inserire la data nel formato aaaa-MM-gg</div>
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pToDate.$error.required">Inserire un valore nel campo 'Data a'</div>
									</td>
									<td>
										&nbsp;
									</td>
									<td align="right"><button type="button" class="btn btn-primary" ng-click="addStoricoRes(sr)">Aggiungi periodo</button></td>
								</tr>
								<tr>
									<td colspan="4"><div class="alert alert-danger" ng-show="(isErrorStoricoRes==true)">{{ errorsStoricoRes }}</div></td>
								</tr>
					   		</table>
					   		&nbsp;
					   		<div class="panel panel-default" ng-show="storicoResidenza.length > 0">
					   			<div class="panel-heading">
							   		<h3 class="panel-title"><strong>Storico Residenze in comuni della provincia di Trento</strong></h3>
								</div>
			  					<div class="panel-body">
					  				<table width="100%">
							   			<tr>
											<th>Comune</th>
											<th>Dal </th>
											<th>Al</th>
											<th></th>
										</tr>
					  					<tbody class="animate-repeat" ng-repeat="s in storicoResidenza"> <!-- track by $index -->
										<tr>
											<td>
												{{ getComuneById(s.idComuneResidenza,2) }}
								    		</td>
											<td>
								    			{{ (s.dataDa | date:"dd/MM/yyyy") }}
								    		</td>
								    		<td>
												{{ (s.dataA | date:"dd/MM/yyyy") }}
											</td>
											<td>
												<button type="button" class="btn btn-primary" ng-click="deleteStoricoRes(s)">Cancella</button>
											</td>
										</tr>
										</tbody>
									</table>
								</div>
							</div>
					   		<hr>
					   		<table width="100%">
								<tr>			
						   			<td><button type="button" class="btn btn-default" ng-click="hideSRForm()">Annulla</button></td>
						   			<td align="center"></td>
						   			<td align="right"><button type="button" class="btn btn-primary" ng-click="calcolaStoricoRes(ft.content)">Calcola Anni</button></td>
						   		</tr>
						   	</table>
			  			</div>
					</div>
					<div class="form-group" ng-show="isSRFormVisible != true">
				    	<label for="residence_years">Numero anni di residenza (per componente con valore maggiore) : </label>
				    	<table width="100%">
				   			<tr>
				   				<td><input type="number" class="form-control" id="residence_years" placeholder="Inserisci anni residenza" ng-model="ft.content.variazioniComponente.anniResidenza" min="0" disabled ></td>
				    			<td align="right"><button type="button" class="btn btn-primary" ng-click="showSRForm()">Inserisci/Modifica</button></td>
				    		</tr>
				    	</table>
				    </div>
				    <div class="form-group">	
				    	<label for="residence_years_municipality">Numero anni di residenza nel comune in cui &egrave; ubicato l'alloggio: </label>&nbsp;
				   		<input id="residence_years_municipality" type="number" class="form-control" ng-model="ft.content.variazioniComponente.anniResidenzaComune" disabled >
				   	</div>
					<div class="panel panel-default" ng-show="isALFormVisible == true">
			  			<div class="panel-heading">
			   				<h3 class="panel-title"><strong>Anzianit&agrave; lavorativa</strong></h3>
						</div>
			  			<div class="panel-body">
			  				<table  width="100%">
								<tr>
									<th>Anni</th>
									<th>e Mesi</th>
									<th><span ng-show="isDaysVisible == true">e Giorni (se mese esatto indicare 0)</span></th>
									<th></th>
								</tr>
								<tr>
									<td>
			  							<input id="job_old_y" type="number" class="form-control" name="pJobOldY" placeholder="Inserisci anni anzianita' lavorativa" ng-model="comp.anniLavoro" ng-pattern="onlyNumbers">
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pJobOldY.$error.pattern">Valore non corretto. Inserire un valore numerico</div>
						    		</td>
									<td>
			  							<input id="job_old_m" type="number" class="form-control" name="pJobOldM" placeholder="Inserisci mesi restanti anzianita' lavorativa" ng-model="comp.mesiLavoro" ng-pattern="onlyNumbers" ng-change="checkMonths(comp.mesiLavoro)">
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pJobOldM.$error.pattern" >Valore non corretto. Inserire un valore numerico</div>
						    		</td>
									<td>
										<div ng-show="isDaysVisible == true"><input id="job_old_d" type="number" class="form-control" name="pJobOldD" placeholder="Inserisci giorni restanti anzianita' lavorativa" ng-model="comp.giorniLavoro" ng-pattern="onlyNumbers">
										<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pJobOldD.$error.pattern" >Valore non corretto. Inserire un valore numerico</div></div>
									</td>
									<td>&nbsp;</td>
									<td align="right"><button type="button" class="btn btn-primary" ng-click="calcolaAnzianitaLav(comp, ft.content)">Calcola anni</button></td>
								</tr>
								<tr>
									<td colspan="5">&nbsp;</td>
								</tr>
								<tr>			
						   			<td><button type="button" class="btn btn-default" ng-click="hideALForm()">Annulla</button></td>
						   			<td align="center"></td>
						   			<td align="right"></td>
						   		</tr>
						   	</table>
			  			</div>
					</div>
				   	<div class="form-group" ng-show="isALFormVisible != true">
				   		<label for="job_old">Anzianit&agrave; lavorativa: </label>
				   		<table width="100%">
				   			<tr>
				   				<td><input id="job_old" type="number" class="form-control" name="pJobOld" placeholder="Inserisci anzianita' lavorativa" ng-model="ft.content.variazioniComponente.anniLavoro" disabled></td>
				   				<td align="right"><button type="button" class="btn btn-primary" ng-click="showALForm()">Inserisci/Modifica</button></td>
				   			</tr>
				   		</table>   	
				   	</div>
				   	<div class="form-group" ng-show="ft.content.persona.sesso != 'MASCHILE'">
					    <label for="working_woman">Coniuge o Convivente lavoratrice in presenza di figli minori:</label>
					    <input type="checkbox" id="working_woman" ng-model="ft.content.variazioniComponente.donnaLavoratrice">
					</div>
		<!--		<div class="form-group"> -->
		<!--		    <label for="family_guest">Ospite: (tolto perche mai usato)</label> -->
		<!--		    <input type="checkbox" id="family_guest" ng-model="componenteTmpEdit.variazioniComponente.ospite"> -->
		<!--		</div> -->
					<div class="form-group">
					    <label for="not_keeping_lodging">Non occupa l'alloggio: </label><!-- (marito separato di fatto che abita in un altro alloggio) -->
					    <input type="checkbox" id="not_keeping_lodging" ng-model="ft.content.variazioniComponente.fuoriAlloggio">
					</div>
		
					<div class="panel panel-default" ng-show="isDisFormVisible == true">
						<div class="panel-heading">
			   				<h3 class="panel-title"><strong>Invalidit&agrave;</strong></h3>
						</div>
			  			<div class="panel-body">
			  				<div class="form-group">
							    <label for="no_dis">Nessuna Invalidit&agrave;: </label>
							    <input type="radio" ng-model="invalid_age" value="noDis" id="no_dis">
							</div>
			  				<div class="form-group" ng-show="anniComp < 18">
							    <label for="under_18">Invalido Minore di 18 anni (selezionare codice): </label>
							    <input type="radio" ng-model="invalid_age" value="under18" id="under_18">
							</div>
							<div class="form-group" ng-show="invalid_age=='under18'">
						    	<label for="family_invalid_cat">Categoria d'invalidit&agrave;:</label>
								<!-- <input type="text" class="form-control" id="family_invalid_cat" name="pFamilyInvalidCat" placeholder="Seleziona Categoria di invalidit&agrave;" ng-model="ft.content.variazioniComponente.categoriaInvalidita" ng-required="invalid_age=='under18'" > -->
								<select id="family_invalid_cat" name="pFamilyInvalidCat" class="form-control" ng-options="d.value as d.name for d in disabilities_under18" ng-model="ft.disability.catDis" ng-required="invalid_age=='under18'"><!-- ft.content.variazioniComponente.categoriaInvalidita -->
					   			<option value="">Seleziona la categoria di disabilit&agrave;.</option>
					   			</select>
								<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFamilyInvalidCat.$error.required">Campo 'Categoria' obbligatorio per l'et&agrave; del disabile selezionata.</div>
						   	</div>
							<div class="form-group" ng-show="anniComp >= 18 && anniComp < 65">
							    <label for="between_18_65">Invalido con et&agrave; compresa tra i 18 e i 65 anni </label>
							    <input type="radio" ng-model="invalid_age" value="between1865" id="between_18_65">
							</div>
				  			<div class="form-group" ng-show="invalid_age=='between1865'">
							    <label for="mem_disability">Grado d'invalidit&agrave;(%): </label>
							    <input type="number" class="form-control" id="mem_disability" name="pMemDisability" min="0" max="100" placeholder="Inserisci percentuale grado di invalidit&agrave;" ng-model="ft.disability.gradoDis" ng-pattern="onlyNumbers" ng-required="invalid_age=='between1865'">
							   	<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pMemDisability.$error.onlyNumbers">Valore non corretto. Inserire un valore numerico</div>						<!-- ft.content.variazioniComponente.gradoInvalidita -->
							   	<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pMemDisability.$error.required">Grado di invalidit&agrave; obbligatorio per la categoria selezionata.</div>
								<div class="alert alert-danger" ng-show="(fInitFam!=true) && !form.pMemDisability.$valid">Grado di invalidit&agrave; non corretto. Inserire un valore compreso tra 0 e 100.</div>
							</div>
							<div class="form-group" ng-show="anniComp >= 65">
							    <label for="over_65">Invalido ultra 65enne (selezionare codice): </label>
							    <input type="radio" ng-model="invalid_age" value="over65" id="over_65">
							</div>
						   	<div class="form-group" ng-show="invalid_age=='over65'">
						    	<label for="family_invalid_cat">Categoria d'invalidit&agrave;:</label>
								<!-- <input type="text" class="form-control" id="family_invalid_cat" name="pFamilyInvalidCat" placeholder="Seleziona Categoria di invalidit&agrave;" ng-model="ft.content.variazioniComponente.categoriaInvalidita" ng-required="invalid_age=='over65'" > -->
								<select id="family_invalid_cat" name="pFamilyInvalidCat" class="form-control" ng-options="d.value as d.name for d in disabilities_over65" ng-model="ft.disability.catDis" ng-required="invalid_age=='over65'" > <!-- ft.content.variazioniComponente.categoriaInvalidita -->
					   			<option value="">Seleziona la categoria di disabilit&agrave;.</option>
					   			</select>
								<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFamilyInvalidCat.$error.required">Campo 'Categoria' obbligatorio per l'et&agrave; del disabile selezionata.</div>
						   	</div>
						   	<div class="form-group">
							    <label for="blind">Invalido Cieco </label>
							    <input type="checkbox" id="blind" ng-model="ft.disability.cieco">
							</div>
							<div class="form-group">
							    <label for="mute">Invalido Sordomuto</label>
							    <input type="checkbox" id="mute" ng-model="ft.disability.sordoMuto">
							</div>
							<table width="100%">
								<tr>			
							   		<td><button type="button" class="btn btn-default" ng-click="hideDisForm()">Annulla</button></td>
							   		<td align="center"></td> <!-- <button type="button" class="btn btn-default" ng-click="resetDisabilita(ft.content)">Cancella</button> -->
							   		<td align="right"><button type="button" class="btn btn-primary" ng-click="calcolaCategoriaGradoDisabilita()">Conferma</button></td>
							   	</tr>
						   	</table>
			  			</div>
					</div>
					<div class="form-group" ng-show="isDisFormVisible != true">
				   		<label for="job_old">Disabilit&agrave;: </label>
				   		<table width="100%">
				   			<tr>
				   				<th>Categoria Invalidit&agrave;</th>
				   				<th>Grado Invalidit&agrave;</th>
				   				<th>Cieco</th>
				   				<th>SordoMuto</th>
				   				<th></th>
				   			</tr>
				   			<tr>
				   				<td><span ng-if="invalid_age != 'noDis'">{{ ft.disability.catDis  | codeToName: disabilities_all }}</span></td><!-- ft.content.variazioniComponente.categoriaInvalidita -->
				   				<td><span ng-if="invalid_age != 'noDis'">{{ ft.disability.gradoDis }}</span></td><!-- ft.content.variazioniComponente.gradoInvalidita -->
				   				<td>{{ ft.disability.cieco | boolToString }}</td>
				   				<td>{{ ft.disability.sordoMuto | boolToString }}</td>
				   				<td align="right"><button type="button" class="btn btn-primary" ng-click="showDisForm(ft)">Inserisci/Modifica</button></td>
				   			</tr>
				   		</table>   	
				   	</div>
					
				    <div class="form-group" ng-show="ft.content.richiedente">
					   	<label for="fam_municipality">Comune di Residenza: (solo per richiedente)</label>
					  	<select id="fam_municipality" name="pFamMunicipality" class="form-control" ng-options="l.idObj as l.descrizione for l in listaComuni" ng-model="ft.content.variazioniComponente.idComuneResidenza" ng-required="ft.content.richiedente" ng-show="ft.content.variazioniComponente.idComuneResidenza!=null">
					   		<option value="">{{ getComuneById(ft.content.variazioniComponente.idComuneResidenza,2) }}</option>
					   	</select>
					   	<select id="fam_municipality" name="pFamMunicipality" class="form-control" ng-options="l.idObj as l.descrizione for l in listaComuni" ng-model="ft.content.variazioniComponente.idComuneResidenza" ng-required="ft.content.richiedente" ng-show="ft.content.variazioniComponente.idComuneResidenza==null">
					   		<option value="">Seleziona il comune di residenza</option>
					   	</select>
						<!-- <option value="">{{ getComuneById(ft.content.variazioniComponente.idComuneResidenza,2) }}</option> -->
					   	<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFamMunicipality.$error.required">Campo 'Comune Residenza' obbligatorio.</div>
					</div>
					<div class="form-group" ng-show="ft.content.richiedente">
				    	<label for="family_residence">Indirizzo di Residenza: (solo per richiedente)</label>
				    	<input type="text" class="form-control" id="family_residence" name="pFamilyResidence" placeholder="Inserisci Indirizzo Residenza" ng-model="ft.content.variazioniComponente.indirizzoResidenza" ng-required="ft.content.richiedente" >
				   		<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFamilyResidence.$error.required">Campo 'Indirizzo Residenza' obbligatorio.</div>
				   	</div>
				   	<div class="form-group" ng-show="ft.content.richiedente">
				    	<label for="family_civicnum">Numero civico: (solo per richiedente)</label>
				    	<input type="text" class="form-control" id="family_civicnum" name="pCivicNum" placeholder="Inserisci Numero civico" ng-model="ft.content.variazioniComponente.numeroCivico" ng-required="ft.content.richiedente" >
				   		<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pCivicNum.$error.required">Campo 'Numero civico' obbligatorio.</div>
				   	</div>
				   	<div class="form-group" ng-show="ft.content.richiedente">
				    	<label for="family_phone">Telefono: (solo per richiedente)</label>
				    	<input type="text" class="form-control" id="family_phone" name="pFamilyPhone" placeholder="Inserisci Numero di telefono" ng-pattern="onlyNumbers" ng-model="ft.content.variazioniComponente.telefono" ng-required="ft.content.richiedente" ng-pattern="phonePattern">
				   		<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFamilyPhone.$error.pattern">Valore non corretto nel campo telefono. Inserire un valore numerico</div>
				   		<div class="alert alert-danger" ng-show="(fInitFam!=true) && form.pFamilyPhone.$error.required">Campo 'telefono' obbligatorio.</div>
				   	</div>
					<div class="form-group">
				    	<label for="family_note">Note:</label>
				    	<textarea id="family_note" ng-model="ft.content.variazioniComponente.note"></textarea>
				   	</div>
				   	<hr>
			   		<table width="100%">
						<tr>			
				   			<td><button type="button" class="btn btn-default" ng-click="prevFamilyTab()"><span class="glyphicon glyphicon-arrow-left">&nbsp;</span>Indietro</button></td>
				   			<td align="center"><button type="button" class="btn btn-default" ng-click="reset()">RESET</button></td>
				   			<td align="right"><button type="button" class="btn btn-primary" ng-click="nextFamilyTab(form.$invalid, ft.content, ft.disability, invalid_age)">{{buttonNextLabelFamily}}&nbsp;<span class="glyphicon glyphicon-arrow-right" ng-hide="isArrowHide"></span></button></td>
				   		</tr>
				   	</table>
				</div>
			</div>
			
		</tab>
	</tabset>
	
	<table width="100%">
		<tr>			
   			<td><button type="button" class="btn btn-default" ng-click="prevEditTab()"><span class="glyphicon glyphicon-arrow-left">&nbsp;</span>Indietro</button></td>
   			<td align="center"></td>
   			<td align="right"><button type="button" class="btn btn-primary" ng-click="nextEditTab(form.$invalid, 3, null, null, null, null)" ng-disabled="allComponentsEdited == false">{{buttonNextLabel}}&nbsp;<span class="glyphicon glyphicon-arrow-right"></span></button></td>
   		</tr>
   	</table>	
</form>